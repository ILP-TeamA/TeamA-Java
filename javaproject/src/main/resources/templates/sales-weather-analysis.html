<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÂÆüÁ∏æ„ÉªÂ§©Ê∞ó„ÉªË≤©Â£≤ÂÆüÁ∏æË°®Á§∫ - „ÇØ„É©„Éï„Éà„Éì„Éº„É´Áô∫Ê≥®„Ç∑„Çπ„ÉÜ„É†</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/sales-weather-analysis.css}"> <!-- „Åì„ÅÆË°å„ÇíËøΩÂä† -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <!-- <style>„Çø„Ç∞„ÅÆ‰∏≠Ë∫´„ÅØÂÖ®„Å¶ÂâäÈô§ -->
</head>
<body>
    <div class="container">
        <!-- „Éò„ÉÉ„ÉÄ„Éº -->
        <div class="header">
            <h1><i class="fas fa-chart-line"></i> ÂÆüÁ∏æ„ÉªÂ§©Ê∞ó„ÉªË≤©Â£≤ÂÆüÁ∏æË°®Á§∫</h1>
            <p th:if="${displayPeriod}" th:text="${displayPeriod}">2025/6/2 ÔΩû 2025/6/9</p>
        </div>

        <!-- „Ç®„É©„Éº„É°„ÉÉ„Çª„Éº„Ç∏Ë°®Á§∫ -->
        <div th:if="${errorMessage}" class="error-message" th:text="${errorMessage}"></div>

        <!-- Êó•‰ªòÈÅ∏Êäû„Çª„ÇØ„Ç∑„Éß„É≥ -->
        <div class="date-selector">
            <form method="post" action="/sales-weather-analysis">
                <div class="date-input-group">
                    <label for="selectedDate"><i class="fas fa-calendar-alt"></i> ÈñãÂßãÊó•„ÇíÈÅ∏Êäû:</label>
                    <input type="date" 
                           id="selectedDate" 
                           name="selectedDate" 
                           class="date-input"
                           th:value="${selectedDate}"
                           required>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-search"></i> Ë°®Á§∫
                    </button>
                </div>
            </form>
        </div>

        <!-- Â§©Ê∞óÊÉÖÂ†±„Çª„ÇØ„Ç∑„Éß„É≥ -->
        <div class="weather-section">
            <h2><i class="fas fa-cloud-sun"></i> Â§©Ê∞óÊÉÖÂ†±</h2>
            <div class="weather-grid">
                <!-- Â§©Ê∞ó„Éá„Éº„Çø„Åå„ÅÇ„ÇãÂ†¥Âêà -->
                <div class="weather-day" th:each="weather : ${weatherData}" th:if="${weatherData}">
                    <div class="weather-icon" th:text="${weather.weatherIcon}">‚òÄÔ∏è</div>
                    <div class="weather-date" th:text="${#temporals.format(weather.date, 'M/d')}">6/2</div>
                    <div class="weather-temp" th:text="${weather.temperatureRange}">15‚ÑÉ / 25‚ÑÉ</div>
                    <div class="weather-wind" th:text="${weather.windSpeedDisplay}">2.5 m/s</div>
                </div>
                
                <!-- Â§©Ê∞ó„Éá„Éº„Çø„Åå„Å™„ÅÑÂ†¥Âêà„ÅÆ„Çµ„É≥„Éó„É´Ë°®Á§∫ -->
                <div class="weather-day" th:unless="${weatherData}">
                    <div class="weather-icon">‚òÄÔ∏è</div>
                    <div class="weather-date">6/2</div>
                    <div class="weather-temp">15‚ÑÉ / 25‚ÑÉ</div>
                    <div class="weather-wind">2.5 m/s</div>
                </div>
                <div class="weather-day" th:unless="${weatherData}">
                    <div class="weather-icon">‚òÅÔ∏è</div>
                    <div class="weather-date">6/3</div>
                    <div class="weather-temp">12‚ÑÉ / 22‚ÑÉ</div>
                    <div class="weather-wind">3.1 m/s</div>
                </div>
                <div class="weather-day" th:unless="${weatherData}">
                    <div class="weather-icon">‚òî</div>
                    <div class="weather-date">6/4</div>
                    <div class="weather-temp">10‚ÑÉ / 18‚ÑÉ</div>
                    <div class="weather-wind">4.2 m/s</div>
                </div>
                <div class="weather-day" th:unless="${weatherData}">
                    <div class="weather-icon">‚òÄÔ∏è</div>
                    <div class="weather-date">6/5</div>
                    <div class="weather-temp">18‚ÑÉ / 28‚ÑÉ</div>
                    <div class="weather-wind">1.8 m/s</div>
                </div>
                <div class="weather-day" th:unless="${weatherData}">
                    <div class="weather-icon">üå§Ô∏è</div>
                    <div class="weather-date">6/6</div>
                    <div class="weather-temp">16‚ÑÉ / 26‚ÑÉ</div>
                    <div class="weather-wind">2.7 m/s</div>
                </div>
                <div class="weather-day" th:unless="${weatherData}">
                    <div class="weather-icon">‚òÅÔ∏è</div>
                    <div class="weather-date">6/7</div>
                    <div class="weather-temp">14‚ÑÉ / 24‚ÑÉ</div>
                    <div class="weather-wind">3.5 m/s</div>
                </div>
                <div class="weather-day" th:unless="${weatherData}">
                    <div class="weather-icon">‚òÄÔ∏è</div>
                    <div class="weather-date">6/8</div>
                    <div class="weather-temp">17‚ÑÉ / 27‚ÑÉ</div>
                    <div class="weather-wind">2.1 m/s</div>
                </div>
            </div>
        </div>

        <!-- Ë≤©Â£≤ÂÆüÁ∏æ„Ç∞„É©„Éï„Çª„ÇØ„Ç∑„Éß„É≥ -->
        <div class="chart-section">
            <h2><i class="fas fa-chart-bar"></i> Ë≤©Â£≤ÂÆüÁ∏æÔºàÊú¨Êï∞Ôºâ</h2>
            <div class="chart-container">
                <canvas id="salesChart"></canvas>
            </div>
            
            <!-- Âá°‰æã -->
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #FF6B6B;"></div>
                    <span>„Éõ„ÉØ„Ç§„Éà„Éì„Éº„É´</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #4ECDC4;"></div>
                    <span>„É©„Ç¨„Éº</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #45B7D1;"></div>
                    <span>„Éö„Éº„É´„Ç®„Éº„É´</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #96CEB4;"></div>
                    <span>„Éï„É´„Éº„ÉÑ„Éì„Éº„É´</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #FFEAA7;"></div>
                    <span>Èªí„Éì„Éº„É´</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #DDA0DD;"></div>
                    <span>IPA</span>
                </div>
            </div>
        </div>

        <!-- „Éú„Çø„É≥„Çª„ÇØ„Ç∑„Éß„É≥ -->
        <div class="bottom-buttons">
            <a href="/order-quantity-prediction" class="btn btn-primary">
                <i class="fas fa-box"></i> Áô∫Ê≥®Èáè‰∫àÊ∏¨„Å∏
            </a>
            <form method="post" action="/logout" style="display: inline;">
                <button type="submit" class="btn btn-secondary">
                    <i class="fas fa-sign-out-alt"></i> „É≠„Ç∞„Ç¢„Ç¶„Éà
                </button>
            </form>
        </div>
    </div>

    <!-- Chart.js „Çπ„ÇØ„É™„Éó„Éà -->
    <script>
        const ctx = document.getElementById('salesChart').getContext('2d');
        
        // „Éá„Éº„Çø„ÅåÂ≠òÂú®„Åô„ÇãÂ†¥Âêà„ÅØ„Çµ„Éº„Éê„Éº„Çµ„Ç§„Éâ„ÅÆ„Éá„Éº„Çø„Çí‰ΩøÁî®„ÄÅ„Å™„ÅÑÂ†¥Âêà„ÅØ„Çµ„É≥„Éó„É´„Éá„Éº„Çø„Çí‰ΩøÁî®
        const chartLabels = /*[[${chartLabels}]]*/ ['6/2', '6/3', '6/4', '6/5', '6/6', '6/7', '6/8'];
        const chartData = /*[[${chartData}]]*/ [
            {
                label: '„Éõ„ÉØ„Ç§„Éà„Éì„Éº„É´',
                data: [120, 150, 180, 200, 170, 160, 190],
                borderColor: '#FF6B6B',
                backgroundColor: '#FF6B6B',
                fill: false,
                tension: 0.1
            },
            {
                label: '„É©„Ç¨„Éº',
                data: [100, 130, 160, 180, 150, 140, 170],
                borderColor: '#4ECDC4',
                backgroundColor: '#4ECDC4',
                fill: false,
                tension: 0.1
            },
            {
                label: '„Éö„Éº„É´„Ç®„Éº„É´',
                data: [80, 110, 140, 160, 130, 120, 150],
                borderColor: '#45B7D1',
                backgroundColor: '#45B7D1',
                fill: false,
                tension: 0.1
            },
            {
                label: '„Éï„É´„Éº„ÉÑ„Éì„Éº„É´',
                data: [60, 90, 120, 140, 110, 100, 130],
                borderColor: '#96CEB4',
                backgroundColor: '#96CEB4',
                fill: false,
                tension: 0.1
            },
            {
                label: 'Èªí„Éì„Éº„É´',
                data: [40, 70, 100, 120, 90, 80, 110],
                borderColor: '#FFEAA7',
                backgroundColor: '#FFEAA7',
                fill: false,
                tension: 0.1
            },
            {
                label: 'IPA',
                data: [90, 120, 150, 170, 140, 130, 160],
                borderColor: '#DDA0DD',
                backgroundColor: '#DDA0DD',
                fill: false,
                tension: 0.1
            }
        ];
        
        const salesChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: chartLabels,
                datasets: chartData
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    title: {
                        display: true,
                        text: 'Êó•Âà•„Éì„Éº„É´Ë≤©Â£≤ÂÆüÁ∏æ',
                        font: {
                            size: 16
                        }
                    },
                    legend: {
                        display: false // „Ç´„Çπ„Çø„É†Âá°‰æã„Çí‰ΩøÁî®
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 500,
                        title: {
                            display: true,
                            text: 'Ë≤©Â£≤Êú¨Êï∞'
                        },
                        grid: {
                            color: '#e0e0e0'
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: 'Êó•‰ªò'
                        },
                        grid: {
                            color: '#e0e0e0'
                        }
                    }
                },
                interaction: {
                    intersect: false,
                    mode: 'index'
                },
                elements: {
                    point: {
                        radius: 4,
                        hoverRadius: 6
                    },
                    line: {
                        borderWidth: 2
                    }
                }
            }
        });
    </script>

    <!-- Êó•‰ªòÂà∂Èôê„Çπ„ÇØ„É™„Éó„Éà -->
    <script>
        // Êú™Êù•„ÅÆÊó•‰ªò„ÇíÈÅ∏Êäû„Åß„Åç„Å™„ÅÑ„Çà„ÅÜ„Å´Âà∂Èôê
        document.addEventListener('DOMContentLoaded', function() {
            const dateInput = document.getElementById('selectedDate');
            if (dateInput) {
                const today = new Date();
                const yyyy = today.getFullYear();
                const mm = String(today.getMonth() + 1).padStart(2, '0');
                const dd = String(today.getDate()).padStart(2, '0');
                const maxDate = `${yyyy}-${mm}-${dd}`;
                dateInput.setAttribute('max', maxDate);
            }
        });
    </script>
</body>
</html>